---
import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/global.css';

// è®¾è®¡ç”»å¸ƒå¸¸é‡
const DESIGN_W = 1376;
const DESIGN_H = 768;

// Debug æ¨¡å¼ï¼ˆå¼€å‘æ—¶è®¾ä¸º trueï¼Œæˆ–æŒ‰ D é”®åˆ‡æ¢ï¼‰
const DEBUG_MODE = false;

// æ ¸å¿ƒå»ºç­‘ï¼ˆä¸­å¿ƒç‚¹ï¼‰
const coreBuilding = {
  building: {
    src: '/map/core_building.svg',
    rect: { x: 580, y: 180, w: 200, h: 300 },
    transform: { scale: 1.4, dx: 0, dy: 0 },
  },
  center: { x: 688, y: 300 }, // å…‰æŸèµ·ç‚¹
};

// åœ°æ ‡é…ç½®ï¼ˆå•ä¸€æ•°æ®æºï¼‰
// Sign ä½ç½®ï¼šç´§è´´å»ºç­‘åº•è¾¹ï¼ŒsignY = buildingBottomY
const landmarks = [
  {
    id: 'workshop',
    route: '/workshop',
    title_en: 'AI Workshop',
    title_zh: 'AI å®éªŒåŠ',
    building: {
      src: '/map/workshop_building.svg',
      rect: { x: 210, y: 210, w: 240, h: 280 },
      transform: { scale: 1.4, dx: 0, dy: -140 },
    },
    sign: {
      src: '/map/workshop_sign.svg',
      rect: { x: 250, y: 290, w: 140, h: 60 },
      transform: { scale: 2.0, dx: 0, dy: 0 },
    },
    clickableRect: { x: 100, y: 200, w: 240, h: 320 },
    beamEnd: { x: 330, y: 230 }, // è°ƒæ•´åˆ°å»ºç­‘é¡¶éƒ¨æµ®ç©ºæ–¹å—ä½ç½®
  },
  {
    id: 'knowledge',
    route: '/log',
    title_en: 'Knowledge Tower',
    title_zh: 'çŸ¥è¯†å¡”',
    building: {
      src: '/map/knowledge_building.svg',
      rect: { x: 1020, y: 75, w: 300, h: 420 },
      transform: { scale: 1.3, dx: 0, dy: -90 },
    },
    sign: {
      src: '/map/knowledge_sign.svg',
      rect: { x: 1100, y: 290, w: 140, h: 60 },
      transform: { scale: 1.8, dx: 0, dy: 0 },
    },
    clickableRect: { x: 1020, y: 100, w: 300, h: 480 },
    beamEnd: { x: 1170, y: 200 }, // è°ƒæ•´åˆ°å»ºç­‘ä¸­å¿ƒ
  },
  {
    id: 'archives',
    route: '/archives',
    title_en: 'Ancient Archives',
    title_zh: 'å¤å·åº“',
    building: {
      src: '/map/archives_building.svg',
      rect: { x: 80, y: 450, w: 320, h: 300 },
      transform: { scale: 1.3, dx: 0, dy: 0 },
    },
    sign: {
      src: '/map/archives_sign.svg',
      rect: { x: 200, y: 620, w: 200, h: 60 },
      transform: { scale: 1.4, dx: 0, dy: 0 },
    },
    clickableRect: { x: 80, y: 420, w: 320, h: 330 },
    beamEnd: { x: 240, y: 600 }, // è°ƒæ•´åˆ°å»ºç­‘ä¸­å¿ƒ
  },
  {
    id: 'command',
    route: '/command',
    title_en: 'Command Center',
    title_zh: 'æŒ‡æŒ¥æ‰€',
    building: {
      src: '/map/command_building.svg',
      rect: { x: 920, y: 380, w: 360, h: 320 },
      transform: { scale: 0.8, dx: 0, dy: 0 },
    },
    sign: {
      src: '/map/command_sign.svg',
      rect: { x: 1010, y: 630, w: 200, h: 60 },
      transform: { scale: 1.4, dx: 0, dy: 0 },
    },
    clickableRect: { x: 980, y: 400, w: 360, h: 340 },
    beamEnd: { x: 1100, y: 540 }, // è°ƒæ•´åˆ°å»ºç­‘ä¸­å¿ƒ
  },
];
---

<BaseLayout title="Mythic Engraving Interactive Map">
  <div class="map-wrapper">
    <!-- Debug åˆ‡æ¢æŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼‰ -->
    <button class="debug-toggle-btn" id="debugToggle" aria-label="Toggle debug mode">
      <span class="debug-icon">ğŸ”§</span>
    </button>

    <!-- æ±‰å ¡èœå•ï¼ˆå¤‡ç”¨å¯¼èˆªï¼‰ -->
    <button class="hamburger-btn" id="menuToggle" aria-label="Toggle menu">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <nav class="menu-dropdown" id="menuDropdown">
      {landmarks.map(landmark => (
        <a href={landmark.route} class="menu-item">{landmark.title_en}</a>
      ))}
    </nav>

    <!-- å›ºå®šç”»å¸ƒå®¹å™¨ -->
    <div class="map-canvas" id="mapCanvas" data-design-w={DESIGN_W} data-design-h={DESIGN_H}>
      <!-- èƒŒæ™¯å±‚ -->
      <img
        src="/map/background.webp"
        alt="World Map"
        class="map-background"
        fetchpriority="high"
        decoding="async"
      />

      <!-- ä¸»æ ‡é¢˜ -->
      <div class="hero-title" style="left: 688px; top: 55px;">
        <div class="hero-subtitle">FROM BUILDER TO</div>
        <div class="hero-main">INTELLIGENT PIONEER</div>
      </div>

      <!-- å…‰æŸå±‚ï¼ˆå•ä¸€ inline SVG è¦†ç›–å±‚ï¼‰ -->
      <svg class="beam-layer" viewBox={`0 0 ${DESIGN_W} ${DESIGN_H}`} preserveAspectRatio="none">
        <defs>
          <!-- æ¨¡ç³Šæ»¤é•œï¼ˆå¢å¼ºæŸ”å’Œæ•ˆæœï¼‰ -->
          <filter id="blur20">
            <feGaussianBlur stdDeviation="20"/>
          </filter>
          <filter id="blur12">
            <feGaussianBlur stdDeviation="12"/>
          </filter>
          <filter id="blur6">
            <feGaussianBlur stdDeviation="6"/>
          </filter>

          <!-- ä¸­å¿ƒç‚¹æ¸å˜ -->
          <radialGradient id="coreGradient">
            <stop offset="0%" stop-color="#ffffff" />
            <stop offset="50%" stop-color="#ffe8a3" />
            <stop offset="100%" stop-color="#f6d37a" />
          </radialGradient>

          <!-- ä¸ºæ¯æ¡å…‰æŸç”Ÿæˆç‹¬ç«‹çš„æ¸å˜ -->
          {landmarks.map((landmark) => {
            const x1 = coreBuilding.center.x;
            const y1 = coreBuilding.center.y;
            const x2 = landmark.beamEnd.x;
            const y2 = landmark.beamEnd.y;
            const id = landmark.id;

            return (
              <>
                <!-- å†…å±‚æ¸å˜ï¼šç™½è‰²æµåŠ¨èŠ¯ -->
                <linearGradient id={`beamCore-${id}`} x1={x1} y1={y1} x2={x2} y2={y2} gradientUnits="userSpaceOnUse">
                  <stop offset="0%" stop-color="#ffffff" stop-opacity="0.9" />
                  <stop offset="50%" stop-color="#fffef5" stop-opacity="0.85" />
                  <stop offset="100%" stop-color="#ffffff" stop-opacity="0.8" />
                </linearGradient>

                <!-- ä¸­å±‚æ¸å˜ï¼šé‡‘é»„é›¾æ°” -->
                <linearGradient id={`beamWarm-${id}`} x1={x1} y1={y1} x2={x2} y2={y2} gradientUnits="userSpaceOnUse">
                  <stop offset="0%" stop-color="#f6d37a" stop-opacity="0.7" />
                  <stop offset="50%" stop-color="#f0c56a" stop-opacity="0.6" />
                  <stop offset="100%" stop-color="#f6d37a" stop-opacity="0.5" />
                </linearGradient>

                <!-- å¤–å±‚æ¸å˜ï¼šé‡‘é»„å…‰æ™• -->
                <linearGradient id={`beamGold-${id}`} x1={x1} y1={y1} x2={x2} y2={y2} gradientUnits="userSpaceOnUse">
                  <stop offset="0%" stop-color="#f6d37a" stop-opacity="0.5" />
                  <stop offset="50%" stop-color="#f1c85f" stop-opacity="0.4" />
                  <stop offset="100%" stop-color="#f6d37a" stop-opacity="0.3" />
                </linearGradient>
              </>
            );
          })}
        </defs>

        <!-- ä¸­å¿ƒå‘å…‰ç‚¹ï¼ˆå¯ç‚¹å‡»ï¼‰ -->
        <g id="coreBeacon">
          <circle
            cx={coreBuilding.center.x}
            cy={coreBuilding.center.y}
            r="12"
            fill="url(#coreGradient)"
            opacity="0.9"
            style="cursor: pointer;"
          >
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite" />
            <animate attributeName="r" values="12;14;12" dur="2s" repeatCount="indefinite" />
          </circle>

          <!-- å¤–åœˆå…‰æ™• -->
          <circle
            cx={coreBuilding.center.x}
            cy={coreBuilding.center.y}
            r="20"
            fill="none"
            stroke="#ffe8a3"
            stroke-width="1"
            opacity="0.3"
          >
            <animate attributeName="r" values="20;28;20" dur="2.5s" repeatCount="indefinite" />
            <animate attributeName="opacity" values="0.3;0;0.3" dur="2.5s" repeatCount="indefinite" />
          </circle>
        </g>

        <!-- å…‰æŸç»„ï¼ˆä¸‰å±‚å åŠ  + æµåŠ¨é«˜å…‰ï¼‰ -->
        {landmarks.map((landmark, index) => {
          const x1 = coreBuilding.center.x;
          const y1 = coreBuilding.center.y;
          const x2 = landmark.beamEnd.x;
          const y2 = landmark.beamEnd.y;

          // è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹ï¼ˆæ‹±å½¢å‘ä¸Šï¼‰
          const controlX = (x1 + x2) / 2;
          const controlY = Math.min(y1, y2) - 120;
          const pathD = `M ${x1} ${y1} Q ${controlX} ${controlY} ${x2} ${y2}`;

          return (
            <g class="beam-group" data-beam-id={landmark.id}>
              <!-- å¤–å±‚ï¼šææ·¡é‡‘è‰²å…‰æ™•ï¼ˆæœ€å®½ï¼Œå¼ºæ¨¡ç³Šï¼‰ -->
              <path
                class="beam-path beam-outer"
                d={pathD}
                stroke={`url(#beamGold-${landmark.id})`}
                stroke-width="32"
                stroke-linecap="round"
                fill="none"
                filter="url(#blur20)"
                style="opacity: 0;"
              />

              <!-- ä¸­å±‚ï¼šæ·¡é‡‘é›¾æ°”ï¼ˆä¸­ç­‰å®½åº¦ï¼Œä¸­ç­‰æ¨¡ç³Šï¼‰ -->
              <path
                class="beam-path beam-mid"
                d={pathD}
                stroke={`url(#beamWarm-${landmark.id})`}
                stroke-width="16"
                stroke-linecap="round"
                fill="none"
                filter="url(#blur12)"
                style="opacity: 0;"
              />

              <!-- å†…å±‚ï¼šæ·¡ç™½èŠ¯ï¼ˆè¾ƒç»†ï¼Œè½»å¾®æ¨¡ç³Šï¼‰ -->
              <path
                class="beam-path beam-inner"
                d={pathD}
                stroke={`url(#beamCore-${landmark.id})`}
                stroke-width="6"
                stroke-linecap="round"
                fill="none"
                filter="url(#blur6)"
                style="opacity: 0;"
              />

              <!-- æµåŠ¨é«˜å…‰ï¼ˆç™½è‰²ç»†çº¿ï¼‰ -->
              <path
                class="beam-highlight"
                d={pathD}
                stroke="#ffffff"
                stroke-width="1.5"
                stroke-linecap="round"
                fill="none"
                style="opacity: 0;"
                stroke-dasharray="60 120"
                stroke-dashoffset="0"
              />

              <!-- æµåŠ¨ç²’å­æ•ˆæœï¼ˆç™½è‰²å…‰ç‚¹ï¼Œæå¿«æµåŠ¨ï¼‰ -->
              <circle class="beam-particle" r="2.5" fill="#ffffff" filter="url(#blur6)" style="opacity: 0;">
                <animateMotion dur="0.5s" repeatCount="indefinite" begin="0s">
                  <mpath href={`#beam-path-${landmark.id}`}/>
                </animateMotion>
              </circle>

              <circle class="beam-particle" r="2" fill="#ffffff" filter="url(#blur6)" style="opacity: 0;">
                <animateMotion dur="0.5s" repeatCount="indefinite" begin="0.15s">
                  <mpath href={`#beam-path-${landmark.id}`}/>
                </animateMotion>
              </circle>

              <circle class="beam-particle" r="1.5" fill="#fffef5" filter="url(#blur6)" style="opacity: 0;">
                <animateMotion dur="0.5s" repeatCount="indefinite" begin="0.3s">
                  <mpath href={`#beam-path-${landmark.id}`}/>
                </animateMotion>
              </circle>

              <!-- éšè—çš„è·¯å¾„ï¼Œä¾›ç²’å­åŠ¨ç”»ä½¿ç”¨ -->
              <path id={`beam-path-${landmark.id}`} d={pathD} fill="none" stroke="none" style="display: none;"/>
            </g>
          );
        })}
      </svg>

      <!-- æ ¸å¿ƒå»ºç­‘å±‚ï¼ˆå¸¦ transformï¼‰ -->
      <div
        class="building-container core-container"
        data-building-id="core"
        style={`
          left: ${coreBuilding.building.rect.x}px;
          top: ${coreBuilding.building.rect.y}px;
          width: ${coreBuilding.building.rect.w}px;
          height: ${coreBuilding.building.rect.h}px;
          transform: translate(${coreBuilding.building.transform.dx}px, ${coreBuilding.building.transform.dy}px) scale(${coreBuilding.building.transform.scale});
        `}
      >
        <img
          src={coreBuilding.building.src}
          alt="Core Building"
          class="building-layer"
          fetchpriority="high"
          decoding="async"
        />
      </div>

      <!-- åœ°æ ‡å»ºç­‘å±‚ -->
      {landmarks.map(landmark => (
        <div
          class="building-container"
          data-landmark-id={`${landmark.id}-building`}
          style={`
            left: ${landmark.building.rect.x}px;
            top: ${landmark.building.rect.y}px;
            width: ${landmark.building.rect.w}px;
            height: ${landmark.building.rect.h}px;
            transform: translate(${landmark.building.transform.dx}px, ${landmark.building.transform.dy}px) scale(${landmark.building.transform.scale});
          `}
        >
          <img
            src={landmark.building.src}
            alt={`${landmark.title_en} Building`}
            class="building-layer"
            fetchpriority="high"
            decoding="async"
          />
        </div>
      ))}

      <!-- åœ°æ ‡æ ‡ç‰Œå±‚ï¼ˆç‹¬ç«‹æ¸²æŸ“ï¼‰ -->
      {landmarks.map(landmark => (
        <div
          class="sign-container"
          data-landmark-id={`${landmark.id}-sign`}
          style={`
            left: ${landmark.sign.rect.x}px;
            top: ${landmark.sign.rect.y}px;
            width: ${landmark.sign.rect.w}px;
            height: ${landmark.sign.rect.h}px;
            transform: translate(${landmark.sign.transform.dx}px, ${landmark.sign.transform.dy}px) scale(${landmark.sign.transform.scale});
          `}
        >
          <img
            src={landmark.sign.src}
            alt={`${landmark.title_en} Sign`}
            class="sign-bg"
            fetchpriority="high"
            decoding="async"
          />
        </div>
      ))}

      <!-- Resume æ ‡è¯†ï¼ˆä¸­å¤®åº•éƒ¨ï¼‰ -->
      <a
        href="/resume"
        class="resume-badge"
        id="resumeBadge"
        style="
          left: 438px;
          top: 615px;
          width: 500px;
          height: 150px;
        "
        aria-label="View Resume"
      >
        <img
          src="/map/resume.svg"
          alt="Personal Resume Map"
          class="resume-badge-img"
          fetchpriority="high"
          decoding="async"
        />
      </a>

      <!-- ç¤¾äº¤åª’ä½“å›¾æ ‡ï¼ˆResume Sign å†…éƒ¨ï¼‰ -->
      <div class="social-icons-container" style="
        left: 590px;
        top: 715px;
      ">
        <a
          href="https://space.bilibili.com/YOUR_UID"
          target="_blank"
          rel="noopener noreferrer"
          class="social-icon"
          aria-label="Bilibili"
        >
          <img
            src="/map/bilibili.svg"
            alt="Bilibili"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>

        <a
          href="https://github.com/YOUR_USERNAME"
          target="_blank"
          rel="noopener noreferrer"
          class="social-icon"
          aria-label="GitHub"
        >
          <img
            src="/map/github.svg"
            alt="GitHub"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>

        <a
          href="javascript:void(0)"
          class="social-icon"
          aria-label="WeChat Official Account"
          data-popup="gongzhonghao"
        >
          <img
            src="/map/gongzhonghao.svg"
            alt="WeChat Official Account"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>

        <a
          href="javascript:void(0)"
          class="social-icon"
          aria-label="Email"
          data-popup="email"
        >
          <img
            src="/map/email.svg"
            alt="Email"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>

        <a
          href="https://www.xiaohongshu.com/user/profile/YOUR_ID"
          target="_blank"
          rel="noopener noreferrer"
          class="social-icon"
          aria-label="Xiaohongshu"
        >
          <img
            src="/map/xiaohongshu.svg"
            alt="Xiaohongshu"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>

        <a
          href="javascript:void(0)"
          class="social-icon"
          aria-label="WeChat"
          data-popup="wechat"
        >
          <img
            src="/map/wechat.svg"
            alt="WeChat"
            class="social-icon-img"
            fetchpriority="high"
            decoding="async"
          />
        </a>
      </div>

      <!-- å¯ç‚¹å‡»çƒ­åŒºå±‚ -->
      {landmarks.map(landmark => (
        <div
          class="landmark-hotspot-container"
          data-landmark-id={landmark.id}
          style={`
            left: ${landmark.clickableRect.x}px;
            top: ${landmark.clickableRect.y}px;
            width: ${landmark.clickableRect.w}px;
            height: ${landmark.clickableRect.h}px;
          `}
        >
          <a
            href={landmark.route}
            class="landmark-hotspot"
            data-landmark={landmark.id}
            aria-label={`Visit ${landmark.title_en}`}
          >
            <span class="sr-only">{landmark.title_en}</span>
          </a>
        </div>
      ))}

      <!-- Debug å±‚ï¼šæ˜¾ç¤ºè¾¹ç•Œå’Œé”šç‚¹ -->
      <svg class="debug-layer" id="debugLayer" viewBox={`0 0 ${DESIGN_W} ${DESIGN_H}`} preserveAspectRatio="none">
        <!-- æ ¸å¿ƒå»ºç­‘è¾¹ç•Œï¼ˆçº¢è‰²ï¼‰ -->
        <rect
          x={coreBuilding.building.rect.x}
          y={coreBuilding.building.rect.y}
          width={coreBuilding.building.rect.w}
          height={coreBuilding.building.rect.h}
          fill="none"
          stroke="red"
          stroke-width="2"
          stroke-dasharray="5,5"
        />
        <!-- æ ¸å¿ƒå»ºç­‘ä¸­å¿ƒç‚¹ -->
        <circle
          cx={coreBuilding.center.x}
          cy={coreBuilding.center.y}
          r="5"
          fill="red"
          opacity="0.8"
        />
        <text
          x={coreBuilding.center.x + 10}
          y={coreBuilding.center.y - 10}
          font-size="12"
          fill="red"
        >
          Core Center
        </text>

        {landmarks.map(landmark => (
          <>
            <!-- å»ºç­‘è¾¹ç•Œï¼ˆçº¢è‰²ï¼‰ -->
            <rect
              x={landmark.building.rect.x}
              y={landmark.building.rect.y}
              width={landmark.building.rect.w}
              height={landmark.building.rect.h}
              fill="none"
              stroke="red"
              stroke-width="2"
              stroke-dasharray="5,5"
            />
            <!-- æ ‡ç‰Œè¾¹ç•Œï¼ˆè“è‰²ï¼‰ -->
            <rect
              x={landmark.sign.rect.x}
              y={landmark.sign.rect.y}
              width={landmark.sign.rect.w}
              height={landmark.sign.rect.h}
              fill="none"
              stroke="blue"
              stroke-width="2"
              stroke-dasharray="5,5"
            />
            <!-- å¯ç‚¹å‡»åŒºåŸŸè¾¹ç•Œï¼ˆç»¿è‰²ï¼‰ -->
            <rect
              x={landmark.clickableRect.x}
              y={landmark.clickableRect.y}
              width={landmark.clickableRect.w}
              height={landmark.clickableRect.h}
              fill="none"
              stroke="lime"
              stroke-width="2"
              stroke-dasharray="5,5"
            />
            <!-- å…‰æŸç»ˆç‚¹é”šç‚¹ -->
            <circle
              cx={landmark.beamEnd.x}
              cy={landmark.beamEnd.y}
              r="5"
              fill="orange"
              opacity="0.8"
            />
            <text
              x={landmark.beamEnd.x + 10}
              y={landmark.beamEnd.y - 10}
              font-size="12"
              fill="orange"
            >
              {landmark.id}
            </text>
          </>
        ))}
      </svg>
    </div>

    <!-- å°äººè§’è‰²å¼•å¯¼ -->
    <div id="girl-runner">
      <img
        src="/girl/girl.svg"
        alt="guide girl"
        loading="lazy"
        decoding="async"
      />
    </div>

    <!-- å¼¹çª—ç»„ä»¶ -->
    <div id="popup-overlay" class="popup-overlay">
      <div class="popup-container">
        <button class="popup-close" id="popupClose" aria-label="Close popup">Ã—</button>

        <!-- WeChat QR Code å¼¹çª— -->
        <div id="popup-wechat" class="popup-content">
          <h3 class="popup-title">å¾®ä¿¡æ‰«ä¸€æ‰«</h3>
          <img src="/map/qrcode.png" alt="WeChat QR Code" class="popup-qrcode" />
        </div>

        <!-- Email å¼¹çª— -->
        <div id="popup-email" class="popup-content">
          <h3 class="popup-title">ç”µå­é‚®ç®±</h3>
          <div class="popup-text-container">
            <p class="popup-text" id="emailText">wyb3206@163.com</p>
          </div>
          <button class="popup-copy-btn" data-copy="wyb3206@163.com">
            <span class="copy-icon">ğŸ“‹</span>
            <span class="copy-text">å¤åˆ¶</span>
          </button>
        </div>

        <!-- å…¬ä¼—å·å¼¹çª— -->
        <div id="popup-gongzhonghao" class="popup-content">
          <h3 class="popup-title">å…¬ä¼—å·</h3>
          <div class="popup-text-container">
            <p class="popup-text" id="gongzhonghaoText">è´å¡”æ•°æ™ºæ‰€</p>
          </div>
          <button class="popup-copy-btn" data-copy="è´å¡”æ•°æ™ºæ‰€">
            <span class="copy-icon">ğŸ“‹</span>
            <span class="copy-text">å¤åˆ¶</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script type="module" src="/src/scripts/girl-runner.ts"></script>

<style>
  /* å…¨å± Viewport */
  .map-wrapper {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    margin: 0;
    padding: 0;
    background-color: var(--bg-parchment);
  }

  /* Debug åˆ‡æ¢æŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼Œfixed overlayï¼‰ */
  .debug-toggle-btn {
    position: fixed;
    top: 16px;
    right: 16px;
    z-index: 50;
    background: transparent;
    border: 1px solid var(--ink-main);
    padding: 0.5rem;
    cursor: pointer;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    opacity: 0.6;
  }

  .debug-toggle-btn:hover {
    opacity: 1;
    background-color: rgba(31, 31, 31, 0.05);
  }

  .debug-toggle-btn.active {
    background-color: rgba(31, 31, 31, 0.1);
    opacity: 1;
  }

  .debug-icon {
    font-size: 1.25rem;
  }

  /* å›ºå®šç”»å¸ƒ mapStage */
  .map-canvas {
    width: 1376px;
    height: 768px;
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: center center;
    /* transform ç”± JS è®¡ç®—: translate(-50%, -50%) scale(scale) */
  }

  /* èƒŒæ™¯å›¾ï¼ˆæ”¾åœ¨ mapStage å†…ï¼Œå›ºå®šå°ºå¯¸ï¼‰ */
  .map-background {
    position: absolute;
    left: 0;
    top: 0;
    width: 1376px;
    height: 768px;
    object-fit: fill;
    display: block;
    pointer-events: none;
  }

  /* ä¸»æ ‡é¢˜ */
  .hero-title {
    position: absolute;
    transform: translateX(-50%);
    z-index: 5;
    text-align: center;
    pointer-events: none;
  }

  .hero-subtitle {
    font-family: var(--font-serif);
    font-size: 1rem;
    letter-spacing: 0.15em;
    color: #d4c4a8;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
    font-weight: 400;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .hero-main {
    font-family: var(--font-serif);
    font-size: 1.85rem;
    letter-spacing: 0.1em;
    color: #e8dcc0;
    text-transform: uppercase;
    font-weight: 600;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    line-height: 1.2;
  }

  /* å…‰æŸå±‚ï¼ˆå•ä¸€ SVG è¦†ç›–å±‚ï¼‰ */
  .beam-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 30;
    overflow: visible;
  }

  #coreBeacon {
    pointer-events: all;
    cursor: pointer;
  }

  /* å…‰æŸè·¯å¾„ï¼šä¸è¦ç”¨ CSS è¦†ç›– SVG stroke å±æ€§ */
  .beam-path {
    /* ç§»é™¤äº† stroke: unset; é¿å…è¦†ç›– SVG çš„ stroke="url(#...)" */
    transition: opacity 0.8s ease-out;
  }

  /* æ¿€æ´»çŠ¶æ€ï¼šå¢å¼ºäº®åº¦ */
  .beam-group.active .beam-outer {
    opacity: 0.55 !important;
    transition: opacity 1s ease-out;
  }

  .beam-group.active .beam-mid {
    opacity: 0.7 !important;
    transition: opacity 1s ease-out 0.1s;
  }

  .beam-group.active .beam-inner {
    opacity: 0.9 !important;
    transition: opacity 1s ease-out 0.2s;
  }

  /* æµåŠ¨é«˜å…‰åŠ¨ç”»ï¼ˆç™½è‰²æµåŠ¨ï¼Œæå¿«ï¼‰ */
  .beam-highlight {
    transition: opacity 0.6s ease;
  }

  .beam-group.active .beam-highlight {
    opacity: 0.6 !important;
    animation: highlightFlow 1s linear infinite 0.5s;
  }

  @keyframes highlightFlow {
    to {
      stroke-dashoffset: -200;
    }
  }

  /* æµåŠ¨ç²’å­æ•ˆæœï¼ˆç™½è‰²å…‰ç‚¹ï¼Œæå¿«ï¼‰ */
  .beam-particle {
    transition: opacity 0.6s ease;
  }

  .beam-group.active .beam-particle {
    opacity: 0.65 !important;
  }

  /* å»ºç­‘å®¹å™¨ï¼ˆæ”¯æŒ transformï¼‰ */
  .building-container {
    position: absolute;
    transform-origin: center center;
    z-index: 8;
    transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1.2);
  }

  .core-container {
    pointer-events: none;
  }

  /* å»ºç­‘å±‚æ ·å¼ */
  .building-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
    transition: filter 220ms ease;
  }

  /* å»ºç­‘ hover é˜´å½± */
  .building-layer.hover {
    filter: drop-shadow(0 10px 14px rgba(0, 0, 0, 0.22));
  }

  /* æ ‡ç‰Œå®¹å™¨ï¼ˆç‹¬ç«‹æ¸²æŸ“ï¼‰ */
  .sign-container {
    position: absolute;
    transform-origin: center center;
    z-index: 9;
    transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1.2);
  }

  /* æ ‡ç‰Œ SVG */
  .sign-bg {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
  }

  /* Resume æ ‡è¯†ï¼ˆä¸­å¤®åº•éƒ¨ï¼‰ */
  .resume-badge {
    position: absolute;
    z-index: 10;
    transform-origin: center center;
    transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1.2);
    cursor: pointer;
    text-decoration: none;
    display: block;
  }

  .resume-badge:hover {
    transform: translateY(-6px) scale(1.05);
  }

  .resume-badge-img {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
    opacity: 0.9;
    transition: opacity 0.3s ease, filter 220ms ease;
  }

  .resume-badge:hover .resume-badge-img {
    opacity: 1;
    filter: drop-shadow(0 10px 14px rgba(0, 0, 0, 0.22));
  }

  /* ç¤¾äº¤åª’ä½“å›¾æ ‡å®¹å™¨ */
  .social-icons-container {
    position: absolute;
    z-index: 11;
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* å•ä¸ªç¤¾äº¤å›¾æ ‡ */
  .social-icon {
    position: relative;
    width: 32px;
    height: 32px;
    display: block;
    cursor: pointer;
    text-decoration: none;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .social-icon:hover {
    transform: translateY(-8px);
    animation: iconBounce 0.6s ease-in-out;
  }

  .social-icon-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
    opacity: 0.85;
    transition: opacity 0.3s ease, filter 0.3s ease;
  }

  .social-icon:hover .social-icon-img {
    opacity: 1;
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15));
  }

  /* å¼¹è·³åŠ¨ç”» */
  @keyframes iconBounce {
    0%, 100% {
      transform: translateY(-8px);
    }
    50% {
      transform: translateY(-14px);
    }
  }

  /* å¯ç‚¹å‡»çƒ­åŒºå®¹å™¨ */
  .landmark-hotspot-container {
    position: absolute;
    z-index: 15;
  }

  /* å¯ç‚¹å‡»çƒ­åŒº */
  .landmark-hotspot {
    position: absolute;
    inset: 0;
    z-index: 15;
    cursor: pointer;
  }

  /* å°äººè§’è‰²å¼•å¯¼ */
  #girl-runner {
    position: fixed;
    left: 0;
    top: 0;
    width: 72px;
    height: auto;
    pointer-events: none;
    z-index: 15;
    will-change: transform;
  }

  #girl-runner img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* æ±‰å ¡èœå•ï¼ˆå·¦ä¸Šè§’ï¼Œfixed overlayï¼‰ */
  .hamburger-btn {
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 50;
    background: transparent;
    border: 1px solid var(--ink-main);
    padding: 0.4rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 3px;
    width: 28px;
    height: 28px;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
    opacity: 0.6;
  }

  .hamburger-btn:hover {
    opacity: 1;
    background-color: rgba(31, 31, 31, 0.05);
  }

  .hamburger-line {
    width: 14px;
    height: 1.5px;
    background-color: var(--ink-main);
    transition: all 0.3s ease;
  }

  .hamburger-btn.active .hamburger-line:nth-child(1) {
    transform: translateY(4.5px) rotate(45deg);
  }

  .hamburger-btn.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .hamburger-btn.active .hamburger-line:nth-child(3) {
    transform: translateY(-4.5px) rotate(-45deg);
  }

  .menu-dropdown {
    position: fixed;
    top: 52px;
    left: 16px;
    z-index: 50;
    background-color: rgba(239, 233, 198, 0.98);
    border: 1px solid var(--ink-main);
    padding: 0.5rem;
    display: none;
    flex-direction: column;
    gap: 0.5rem;
    min-width: 160px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .menu-dropdown.open {
    display: flex;
  }

  .menu-item {
    font-family: var(--font-sans);
    font-size: 0.875rem;
    color: var(--ink-main);
    padding: 0.5rem 0.75rem;
    border: 1px solid transparent;
    transition: all 0.3s ease;
  }

  .menu-item:hover {
    border-color: var(--ink-main);
    background-color: rgba(31, 31, 31, 0.03);
  }

  /* Debug å±‚ */
  .debug-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .debug-layer.visible {
    opacity: 1;
  }

  /* å±å¹•é˜…è¯»å™¨ä¸“ç”¨ */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* å°Šé‡ç”¨æˆ·åŠ¨ç”»åå¥½ */
  @media (prefers-reduced-motion: reduce) {
    .beam-path,
    .beam-highlight {
      animation: none !important;
      transition: opacity 0.3s ease;
    }

    .beam-highlight {
      stroke-dasharray: none !important;
      stroke-dashoffset: 0 !important;
    }

    circle animate {
      display: none;
    }

    .building-layer,
    .sign-container {
      transition: none !important;
    }

    .social-icon,
    .social-icon:hover {
      animation: none !important;
      transition: none !important;
    }
  }

  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 768px) {
    .debug-toggle-btn {
      width: 32px;
      height: 32px;
      top: 12px;
      right: 12px;
    }

    .debug-icon {
      font-size: 1rem;
    }

    /* ç§»åŠ¨ç«¯éšè—ç¤¾äº¤å›¾æ ‡ï¼ˆé¿å…é®æŒ¡ï¼‰ */
    .social-icons-container {
      display: none;
    }

    /* ç§»åŠ¨ç«¯æ ‡é¢˜è°ƒæ•´ */
    .hero-subtitle {
      font-size: 0.625rem;
      letter-spacing: 0.1em;
    }

    .hero-main {
      font-size: 1.25rem;
      letter-spacing: 0.08em;
    }
  }

  /* å¼¹çª—æ ·å¼ */
  .popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: none;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .popup-overlay.active {
    display: flex;
    opacity: 1;
  }

  .popup-container {
    position: relative;
    background: var(--bg-parchment);
    border: 2px solid var(--ink-main);
    padding: 2.5rem 2rem 2rem;
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 4px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transform: scale(0.9);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .popup-overlay.active .popup-container {
    transform: scale(1);
  }

  .popup-close {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: transparent;
    border: none;
    font-size: 2rem;
    line-height: 1;
    color: var(--ink-soft);
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    transition: color 0.3s ease, transform 0.3s ease;
  }

  .popup-close:hover {
    color: var(--ink-main);
    transform: scale(1.1);
  }

  .popup-content {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }

  .popup-content.active {
    display: flex;
  }

  .popup-title {
    font-family: var(--font-zh-display);
    font-size: 1.5rem;
    color: var(--ink-main);
    margin: 0;
    font-weight: 400;
  }

  .popup-qrcode {
    width: 280px;
    height: 280px;
    object-fit: contain;
    border: 1px solid rgba(74, 74, 74, 0.2);
    background: white;
    padding: 0.5rem;
  }

  .popup-text-container {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(74, 74, 74, 0.2);
    padding: 1rem 1.5rem;
    border-radius: 4px;
    min-width: 280px;
  }

  .popup-text {
    font-family: var(--font-zh-body);
    font-size: 1.125rem;
    color: var(--ink-main);
    margin: 0;
    text-align: center;
    user-select: all;
  }

  .popup-copy-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--ink-main);
    color: var(--bg-parchment);
    border: none;
    padding: 0.75rem 1.5rem;
    font-family: var(--font-sans);
    font-size: 1rem;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .popup-copy-btn:hover {
    background: var(--ink-soft);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .popup-copy-btn:active {
    transform: translateY(0);
  }

  .popup-copy-btn.copied {
    background: #4caf50;
  }

  .copy-icon {
    font-size: 1.25rem;
  }

  .copy-text {
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .popup-container {
      padding: 2rem 1.5rem 1.5rem;
    }

    .popup-title {
      font-size: 1.25rem;
    }

    .popup-qrcode {
      width: 220px;
      height: 220px;
    }

    .popup-text-container {
      min-width: 240px;
    }

    .popup-text {
      font-size: 1rem;
    }
  }
</style>

<script>
  // ç¡®ä¿ DOM åŠ è½½å®Œæˆåæ‰§è¡Œ
  document.addEventListener('DOMContentLoaded', () => {
    // åœ°æ ‡é…ç½®æ•°æ®ï¼ˆç”¨äº hover åŠ¨ç”»è®¡ç®—ï¼‰
    const landmarks = [
      {
        id: 'workshop',
        building: { transform: { scale: 1.4, dx: 0, dy: -140 } },
        sign: { transform: { scale: 2.0, dx: 0, dy: 0 } },
      },
      {
        id: 'knowledge',
        building: { transform: { scale: 1.3, dx: 0, dy: -90 } },
        sign: { transform: { scale: 1.8, dx: 0, dy: 0 } },
      },
      {
        id: 'archives',
        building: { transform: { scale: 1.3, dx: 0, dy: 0 } },
        sign: { transform: { scale: 1.4, dx: 0, dy: 0 } },
      },
      {
        id: 'command',
        building: { transform: { scale: 0.8, dx: 0, dy: 0 } },
        sign: { transform: { scale: 1.4, dx: 0, dy: 0 } },
      },
    ];

    // ç”»å¸ƒç¼©æ”¾é€»è¾‘
    const DESIGN_W = 1376;
    const DESIGN_H = 768;

    const mapCanvas = document.getElementById('mapCanvas');
    const debugLayer = document.getElementById('debugLayer');
    const debugToggle = document.getElementById('debugToggle');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Debug æ¨¡å¼çŠ¶æ€
    let debugMode = false;

    // å…‰æŸç³»ç»Ÿï¼šhover äº¤äº’
    const coreBeacon = document.getElementById('coreBeacon');
    const beamGroups = document.querySelectorAll('.beam-group');

    console.log('æ‰¾åˆ°å…‰æŸç»„æ•°é‡:', beamGroups.length);

    // å…‰æŸçŠ¶æ€ç®¡ç†ï¼šé˜²æ­¢å¤šä¸ªç³»ç»Ÿå†²çª
    let beamMode = 'none'; // 'none' | 'all' | 'single'
    let activeBeamTimeouts = [];

    // æ¸…é™¤æ‰€æœ‰å…‰æŸçš„è¾…åŠ©å‡½æ•°
    function clearAllBeams() {
      console.log('æ¸…é™¤æ‰€æœ‰å…‰æŸ');
      // æ¸…é™¤æ‰€æœ‰å¾…æ‰§è¡Œçš„æ¿€æ´»åŠ¨ç”»
      activeBeamTimeouts.forEach(timeout => clearTimeout(timeout));
      activeBeamTimeouts = [];
      // ç§»é™¤æ‰€æœ‰activeç±»
      beamGroups.forEach(group => {
        group.classList.remove('active');
      });
    }

    // è°ƒè¯•ï¼šæ‰“å°å½“å‰å…‰æŸçŠ¶æ€
    function logBeamState() {
      const activeBeams = [];
      beamGroups.forEach(group => {
        const id = group.getAttribute('data-beam-id');
        if (group.classList.contains('active')) {
          activeBeams.push(id);
        }
      });
      console.log(`[å…‰æŸçŠ¶æ€] æ¨¡å¼: ${beamMode}, æ¿€æ´»çš„å…‰æŸ: [${activeBeams.join(', ')}]`);
    }

    // ä¸­å¿ƒå»ºç­‘ hoverï¼šæ˜¾ç¤ºæ‰€æœ‰å…‰æŸ
    if (coreBeacon) {
      coreBeacon.addEventListener('mouseenter', () => {
        console.log('é¼ æ ‡è¿›å…¥ä¸­å¿ƒå»ºç­‘ï¼Œæ˜¾ç¤ºæ‰€æœ‰å…‰æŸ');
        clearAllBeams(); // å…ˆæ¸…é™¤æ‰€æœ‰å…‰æŸ
        beamMode = 'all';
        beamGroups.forEach((group, index) => {
          const timeout = setTimeout(() => {
            if (beamMode === 'all') { // åªæœ‰åœ¨ä»å¤„äº 'all' æ¨¡å¼æ—¶æ‰æ¿€æ´»
              group.classList.add('active');
              if (index === beamGroups.length - 1) {
                // æœ€åä¸€æ¡å…‰æŸæ¿€æ´»åï¼Œæ‰“å°çŠ¶æ€
                setTimeout(() => logBeamState(), 50);
              }
            }
          }, index * 80);
          activeBeamTimeouts.push(timeout);
        });
      });

      coreBeacon.addEventListener('mouseleave', () => {
        console.log('é¼ æ ‡ç¦»å¼€ä¸­å¿ƒå»ºç­‘ï¼Œéšè—æ‰€æœ‰å…‰æŸ');
        beamMode = 'none';
        clearAllBeams();
        logBeamState();
      });
    }

  function scaleCanvas() {
    const viewportW = window.innerWidth;
    const viewportH = window.innerHeight;

    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
    const scale = Math.min(viewportW / DESIGN_W, viewportH / DESIGN_H);

    // åº”ç”¨ç¼©æ”¾å˜æ¢ï¼ˆtranslate(-50%, -50%) å±…ä¸­ï¼Œç„¶å scaleï¼‰
    if (mapCanvas) {
      mapCanvas.style.transform = `translate(-50%, -50%) scale(${scale})`;
    }
  }

  // åˆå§‹ç¼©æ”¾
  scaleCanvas();

  // çª—å£è°ƒæ•´æ—¶é‡æ–°ç¼©æ”¾
  window.addEventListener('resize', scaleCanvas);

  // Debug åˆ‡æ¢
  if (debugToggle && debugLayer) {
    debugToggle.addEventListener('click', () => {
      debugMode = !debugMode;
      debugToggle.classList.toggle('active', debugMode);
      debugLayer.classList.toggle('visible', debugMode);

      if (debugMode) {
        console.log('=== Debug Mode Enabled ===');
        console.log(`Canvas Size: ${DESIGN_W}x${DESIGN_H}`);
        printLandmarkCoordinates();
      }
    });

    // é”®ç›˜å¿«æ·é”®ï¼šD é”®åˆ‡æ¢ debug
    document.addEventListener('keydown', (e) => {
      if (e.key === 'd' || e.key === 'D') {
        debugToggle.click();
      }
    });
  }

  // æ‰“å°åœ°æ ‡åæ ‡
  function printLandmarkCoordinates() {
    const landmarks = document.querySelectorAll('.landmark-group');
    const coreContainer = document.querySelector('.core-container');

    console.log('--- Core Building ---');
    if (coreContainer) {
      const style = coreContainer.style;
      console.log(`  rect: { x: ${style.left}, y: ${style.top}, w: ${style.width}, h: ${style.height} }`);
      console.log(`  transform: ${style.transform}`);
    }

    console.log('\n--- Landmarks ---');
    landmarks.forEach(group => {
      const id = group.getAttribute('data-landmark-id');
      const style = group.style;
      console.log(`${id}:`);
      console.log(`  rect: { x: ${style.left}, y: ${style.top}, w: ${style.width}, h: ${style.height} }`);
      console.log(`  transform: ${style.transform}`);
    });
  }

  // åœ°æ ‡äº¤äº’ï¼ˆåŸºäºæ–°çš„åˆ†å±‚ç»“æ„ï¼‰
  const hotspotContainers = document.querySelectorAll('.landmark-hotspot-container');

  hotspotContainers.forEach(container => {
    const landmarkId = container.getAttribute('data-landmark-id');
    const hotspot = container.querySelector('.landmark-hotspot');
    const buildingContainer = document.querySelector(`[data-landmark-id="${landmarkId}-building"]`);
    const signContainer = document.querySelector(`[data-landmark-id="${landmarkId}-sign"]`);
    const correspondingBeam = document.querySelector(`.beam-group[data-beam-id="${landmarkId}"]`);

    // ä¿å­˜å»ºç­‘å’Œæ ‡ç‰ŒåŸå§‹ transform
    let originalBuildingTransform = '';
    let originalSignTransform = '';
    if (buildingContainer) {
      originalBuildingTransform = buildingContainer.style.transform;
    }
    if (signContainer) {
      originalSignTransform = signContainer.style.transform;
    }

    // Hover äº¤äº’ï¼ˆå»ºç­‘æµ®èµ· + æ ‡ç‰Œæµ®èµ· + æ˜¾ç¤ºå¯¹åº”å…‰æŸï¼‰
    container.addEventListener('mouseenter', () => {
      console.log(`[${landmarkId}] é¼ æ ‡è¿›å…¥å»ºç­‘`);

      // å»ºç­‘æµ®èµ·åŠ¨ç”»ï¼ˆåœ¨åŸæœ‰ transform åŸºç¡€ä¸Šæ·»åŠ æµ®èµ·æ•ˆæœï¼‰
      if (buildingContainer) {
        const landmark = landmarks.find(l => l.id === landmarkId);
        if (landmark) {
          const dx = landmark.building.transform.dx;
          const dy = landmark.building.transform.dy - 6; // å‘ä¸Šæµ®èµ· 6px
          const scale = landmark.building.transform.scale * 1.03; // æ”¾å¤§ 1.03 å€
          buildingContainer.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
        }

        // æ·»åŠ é˜´å½±åˆ°å»ºç­‘å›¾å±‚
        const img = buildingContainer.querySelector('.building-layer');
        if (img) img.classList.add('hover');
      }

      // æ ‡ç‰Œä¹Ÿæµ®èµ·ï¼ˆå’Œå»ºç­‘åŒæ­¥ï¼‰
      if (signContainer) {
        const landmark = landmarks.find(l => l.id === landmarkId);
        if (landmark) {
          const dx = landmark.sign.transform.dx;
          const dy = landmark.sign.transform.dy - 6; // å‘ä¸Šæµ®èµ· 6px
          const scale = landmark.sign.transform.scale * 1.02; // ç¨å¾®æ”¾å¤§
          signContainer.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
        }
      }

      // æ˜¾ç¤ºå¯¹åº”å…‰æŸï¼ˆä½¿ç”¨é›†ä¸­å¼çŠ¶æ€ç®¡ç†ï¼‰
      if (correspondingBeam) {
        console.log(`[${landmarkId}] åˆ‡æ¢åˆ°å•å…‰æŸæ¨¡å¼`);
        beamMode = 'single';
        clearAllBeams(); // å…ˆæ¸…é™¤æ‰€æœ‰å…‰æŸï¼ˆåŒ…æ‹¬å¯èƒ½çš„ä¸­å¿ƒå»ºç­‘æ¿€æ´»çš„å…‰æŸï¼‰
        correspondingBeam.classList.add('active');
        logBeamState();
      }
    });

    container.addEventListener('mouseleave', () => {
      console.log(`[${landmarkId}] é¼ æ ‡ç¦»å¼€å»ºç­‘`);

      // æ¢å¤å»ºç­‘åŸå§‹ transform
      if (buildingContainer) {
        buildingContainer.style.transform = originalBuildingTransform;

        // ç§»é™¤é˜´å½±
        const img = buildingContainer.querySelector('.building-layer');
        if (img) img.classList.remove('hover');
      }

      // æ¢å¤æ ‡ç‰ŒåŸå§‹ transform
      if (signContainer) {
        signContainer.style.transform = originalSignTransform;
      }

      // éšè—å¯¹åº”å…‰æŸ
      if (correspondingBeam && beamMode === 'single') {
        console.log(`[${landmarkId}] éšè—å…‰æŸ`);
        beamMode = 'none';
        clearAllBeams();
        logBeamState();
      }
    });

    // Click äº¤äº’
    if (hotspot) {
      hotspot.addEventListener('click', (e) => {
        const href = hotspot.getAttribute('href');
        if (prefersReducedMotion || !href) {
          return;
        }
        e.preventDefault();
        setTimeout(() => {
          window.location.href = href;
        }, 150);
      });
    }
  });

  // æ±‰å ¡èœå•äº¤äº’
  const menuToggle = document.getElementById('menuToggle');
  const menuDropdown = document.getElementById('menuDropdown');

  if (menuToggle && menuDropdown) {
    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
      menuDropdown.classList.toggle('open');
    });

    document.addEventListener('click', (e) => {
      if (!menuToggle.contains(e.target) && !menuDropdown.contains(e.target)) {
        menuToggle.classList.remove('active');
        menuDropdown.classList.remove('open');
      }
    });

    const menuItems = menuDropdown.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        menuToggle.classList.remove('active');
        menuDropdown.classList.remove('open');
      });
    });
  }

  // Resume Badge äº¤äº’
  const resumeBadge = document.getElementById('resumeBadge');
  if (resumeBadge) {
    resumeBadge.addEventListener('click', (e) => {
      const href = resumeBadge.getAttribute('href');
      if (prefersReducedMotion || !href) {
        return;
      }
      e.preventDefault();
      setTimeout(() => {
        window.location.href = href;
      }, 150);
    });
  }

  // å¼¹çª—é€»è¾‘
  const popupOverlay = document.getElementById('popup-overlay');
  const popupClose = document.getElementById('popupClose');
  const popupContents = document.querySelectorAll('.popup-content');

  // æ‰“å¼€å¼¹çª—å‡½æ•°
  function openPopup(type) {
    // éšè—æ‰€æœ‰å¼¹çª—å†…å®¹
    popupContents.forEach(content => {
      content.classList.remove('active');
    });

    // æ˜¾ç¤ºå¯¹åº”çš„å¼¹çª—å†…å®¹
    const targetContent = document.getElementById(`popup-${type}`);
    if (targetContent) {
      targetContent.classList.add('active');
    }

    // æ˜¾ç¤ºå¼¹çª—é®ç½©
    popupOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // å…³é—­å¼¹çª—å‡½æ•°
  function closePopup() {
    popupOverlay.classList.remove('active');
    document.body.style.overflow = '';
  }

  // ä¸ºç¤¾äº¤å›¾æ ‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
  const socialIcons = document.querySelectorAll('.social-icon[data-popup]');
  socialIcons.forEach(icon => {
    icon.addEventListener('click', (e) => {
      e.preventDefault();
      const popupType = icon.getAttribute('data-popup');
      if (popupType) {
        openPopup(popupType);
      }
    });
  });

  // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  if (popupClose) {
    popupClose.addEventListener('click', closePopup);
  }

  // ç‚¹å‡»é®ç½©å…³é—­å¼¹çª—
  if (popupOverlay) {
    popupOverlay.addEventListener('click', (e) => {
      if (e.target === popupOverlay) {
        closePopup();
      }
    });
  }

  // ESC é”®å…³é—­å¼¹çª—
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && popupOverlay.classList.contains('active')) {
      closePopup();
    }
  });

  // å¤åˆ¶æŒ‰é’®åŠŸèƒ½
  const copyButtons = document.querySelectorAll('.popup-copy-btn');
  copyButtons.forEach(btn => {
    btn.addEventListener('click', async () => {
      const textToCopy = btn.getAttribute('data-copy');
      const copyText = btn.querySelector('.copy-text');
      const originalText = copyText.textContent;

      try {
        await navigator.clipboard.writeText(textToCopy);

        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸçŠ¶æ€
        btn.classList.add('copied');
        copyText.textContent = 'å·²å¤åˆ¶';

        // 2ç§’åæ¢å¤åŸçŠ¶
        setTimeout(() => {
          btn.classList.remove('copied');
          copyText.textContent = originalText;
        }, 2000);
      } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        copyText.textContent = 'å¤åˆ¶å¤±è´¥';
        setTimeout(() => {
          copyText.textContent = originalText;
        }, 2000);
      }
    });
  });

  }); // ç»“æŸ DOMContentLoaded
</script>
